(window.webpackJsonp=window.webpackJsonp||[]).push([[12],{179:function(t,e,n){"use strict";n.r(e);var r={},l=n(2),component=Object(l.a)(r,(function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",[t._m(0),t._v(" "),n("p",[t._v("Finding a better solution for what we wanted was quite a journey, so before we go over the failed attempts and other potential options.")]),t._v(" "),n("h3",{attrs:{id:"solutions-that-didnt-work"}},[n("a",{staticClass:"md-headingAnchor",attrs:{href:"#solutions-that-didnt-work","aria-hidden":"true"}},[n("svg",{attrs:{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 512 512"}},[n("path",{attrs:{d:"M280 341.1l-1.2.1c-3.6.4-7 2-9.6 4.5l-64.6 64.6c-13.7 13.7-32 21.2-51.5 21.2s-37.8-7.5-51.5-21.2c-13.7-13.7-21.2-32-21.2-51.5s7.5-37.8 21.2-51.5l68.6-68.6c3.5-3.5 7.3-6.6 11.4-9.3 4.6-3 9.6-5.6 14.8-7.5 4.8-1.8 9.9-3 15-3.7 3.4-.5 6.9-.7 10.2-.7 1.4 0 2.8.1 4.6.2 17.7 1.1 34.4 8.6 46.8 21 7.7 7.7 13.6 17.1 17.1 27.3 2.8 8 11.2 12.5 19.3 10.1.1 0 .2-.1.3-.1.1 0 .2 0 .2-.1 8.1-2.5 12.8-11 10.5-19.1-4.4-15.6-12.2-28.7-24.6-41-15.6-15.6-35.9-25.8-57.6-29.3-1.9-.3-3.8-.6-5.7-.8-3.7-.4-7.4-.6-11.1-.6-2.6 0-5.2.1-7.7.3-5.4.4-10.8 1.2-16.2 2.5-1.1.2-2.1.5-3.2.8-6.7 1.8-13.3 4.2-19.5 7.3-10.3 5.1-19.6 11.7-27.7 19.9l-68.6 68.6C58.9 304.4 48 330.8 48 359c0 28.2 10.9 54.6 30.7 74.4C98.5 453.1 124.9 464 153 464c28.2 0 54.6-10.9 74.4-30.7l65.3-65.3c10.4-10.5 2-28.3-12.7-26.9z"}}),n("path",{attrs:{d:"M433.3 78.7C413.5 58.9 387.1 48 359 48s-54.6 10.9-74.4 30.7l-63.7 63.7c-9.7 9.7-3.6 26.3 10.1 27.4 4.7.4 9.3-1.3 12.7-4.6l63.8-63.6c13.7-13.7 32-21.2 51.5-21.2s37.8 7.5 51.5 21.2c13.7 13.7 21.2 32 21.2 51.5s-7.5 37.8-21.2 51.5l-68.6 68.6c-3.5 3.5-7.3 6.6-11.4 9.3-4.6 3-9.6 5.6-14.8 7.5-4.8 1.8-9.9 3-15 3.7-3.4.5-6.9.7-10.2.7-1.4 0-2.9-.1-4.6-.2-17.7-1.1-34.4-8.6-46.8-21-7.3-7.3-12.8-16-16.4-25.5-2.9-7.7-11.1-11.9-19.1-9.8-8.9 2.3-14.1 11.7-11.3 20.5 4.5 14 12.1 25.9 23.7 37.5l.2.2c16.9 16.9 39.4 27.6 63.3 30.1 3.7.4 7.4.6 11.1.6 2.6 0 5.2-.1 7.8-.3 6.5-.5 13-1.6 19.3-3.2 6.7-1.8 13.3-4.2 19.5-7.3 10.3-5.1 19.6-11.7 27.7-19.9l68.6-68.6c19.8-19.8 30.7-46.2 30.7-74.4s-11.1-54.6-30.9-74.4z"}})])]),t._v(" Solutions that didn't work")]),t._v(" "),n("h4",{attrs:{id:"1-making-a-handlebars-helper"}},[n("a",{staticClass:"md-headingAnchor",attrs:{href:"#1-making-a-handlebars-helper","aria-hidden":"true"}},[n("svg",{attrs:{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 512 512"}},[n("path",{attrs:{d:"M280 341.1l-1.2.1c-3.6.4-7 2-9.6 4.5l-64.6 64.6c-13.7 13.7-32 21.2-51.5 21.2s-37.8-7.5-51.5-21.2c-13.7-13.7-21.2-32-21.2-51.5s7.5-37.8 21.2-51.5l68.6-68.6c3.5-3.5 7.3-6.6 11.4-9.3 4.6-3 9.6-5.6 14.8-7.5 4.8-1.8 9.9-3 15-3.7 3.4-.5 6.9-.7 10.2-.7 1.4 0 2.8.1 4.6.2 17.7 1.1 34.4 8.6 46.8 21 7.7 7.7 13.6 17.1 17.1 27.3 2.8 8 11.2 12.5 19.3 10.1.1 0 .2-.1.3-.1.1 0 .2 0 .2-.1 8.1-2.5 12.8-11 10.5-19.1-4.4-15.6-12.2-28.7-24.6-41-15.6-15.6-35.9-25.8-57.6-29.3-1.9-.3-3.8-.6-5.7-.8-3.7-.4-7.4-.6-11.1-.6-2.6 0-5.2.1-7.7.3-5.4.4-10.8 1.2-16.2 2.5-1.1.2-2.1.5-3.2.8-6.7 1.8-13.3 4.2-19.5 7.3-10.3 5.1-19.6 11.7-27.7 19.9l-68.6 68.6C58.9 304.4 48 330.8 48 359c0 28.2 10.9 54.6 30.7 74.4C98.5 453.1 124.9 464 153 464c28.2 0 54.6-10.9 74.4-30.7l65.3-65.3c10.4-10.5 2-28.3-12.7-26.9z"}}),n("path",{attrs:{d:"M433.3 78.7C413.5 58.9 387.1 48 359 48s-54.6 10.9-74.4 30.7l-63.7 63.7c-9.7 9.7-3.6 26.3 10.1 27.4 4.7.4 9.3-1.3 12.7-4.6l63.8-63.6c13.7-13.7 32-21.2 51.5-21.2s37.8 7.5 51.5 21.2c13.7 13.7 21.2 32 21.2 51.5s-7.5 37.8-21.2 51.5l-68.6 68.6c-3.5 3.5-7.3 6.6-11.4 9.3-4.6 3-9.6 5.6-14.8 7.5-4.8 1.8-9.9 3-15 3.7-3.4.5-6.9.7-10.2.7-1.4 0-2.9-.1-4.6-.2-17.7-1.1-34.4-8.6-46.8-21-7.3-7.3-12.8-16-16.4-25.5-2.9-7.7-11.1-11.9-19.1-9.8-8.9 2.3-14.1 11.7-11.3 20.5 4.5 14 12.1 25.9 23.7 37.5l.2.2c16.9 16.9 39.4 27.6 63.3 30.1 3.7.4 7.4.6 11.1.6 2.6 0 5.2-.1 7.8-.3 6.5-.5 13-1.6 19.3-3.2 6.7-1.8 13.3-4.2 19.5-7.3 10.3-5.1 19.6-11.7 27.7-19.9l68.6-68.6c19.8-19.8 30.7-46.2 30.7-74.4s-11.1-54.6-30.9-74.4z"}})])]),t._v(" 1. Making a handlebars helper")]),t._v(" "),n("p",[t._v("My first idea was to just wrap the entire page in a helper that would lazy-ify the images.")]),t._v(" "),n("pre",{staticClass:"md-codeBlock hljs",attrs:{"data-lang":"html"}},[n("code",{staticClass:"hljs-inner md-codeBlockInner"},[t._v(t._s("{{")+"#lazify}}\n  "),t._m(1),t._v("some html"),t._m(2),t._v("\n"+t._s("{{")+"/lazyify}}\n")])]),t._v(" "),n("p",[t._v("However... how exactly does one even add a helper to ghost's core?")]),t._v(" "),n("p",[t._v('Well, there\'s actually an undocumented plugin system built within ghost called an "app". You can register an app and add handlebars helpers or do whatever. There are examples of it in the ghost install itself. However, there are three issues with this solution:')]),t._v(" "),t._m(3),t._v(" "),n("h4",{attrs:{id:"2-modifying-the-markdown-parser"}},[n("a",{staticClass:"md-headingAnchor",attrs:{href:"#2-modifying-the-markdown-parser","aria-hidden":"true"}},[n("svg",{attrs:{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 512 512"}},[n("path",{attrs:{d:"M280 341.1l-1.2.1c-3.6.4-7 2-9.6 4.5l-64.6 64.6c-13.7 13.7-32 21.2-51.5 21.2s-37.8-7.5-51.5-21.2c-13.7-13.7-21.2-32-21.2-51.5s7.5-37.8 21.2-51.5l68.6-68.6c3.5-3.5 7.3-6.6 11.4-9.3 4.6-3 9.6-5.6 14.8-7.5 4.8-1.8 9.9-3 15-3.7 3.4-.5 6.9-.7 10.2-.7 1.4 0 2.8.1 4.6.2 17.7 1.1 34.4 8.6 46.8 21 7.7 7.7 13.6 17.1 17.1 27.3 2.8 8 11.2 12.5 19.3 10.1.1 0 .2-.1.3-.1.1 0 .2 0 .2-.1 8.1-2.5 12.8-11 10.5-19.1-4.4-15.6-12.2-28.7-24.6-41-15.6-15.6-35.9-25.8-57.6-29.3-1.9-.3-3.8-.6-5.7-.8-3.7-.4-7.4-.6-11.1-.6-2.6 0-5.2.1-7.7.3-5.4.4-10.8 1.2-16.2 2.5-1.1.2-2.1.5-3.2.8-6.7 1.8-13.3 4.2-19.5 7.3-10.3 5.1-19.6 11.7-27.7 19.9l-68.6 68.6C58.9 304.4 48 330.8 48 359c0 28.2 10.9 54.6 30.7 74.4C98.5 453.1 124.9 464 153 464c28.2 0 54.6-10.9 74.4-30.7l65.3-65.3c10.4-10.5 2-28.3-12.7-26.9z"}}),n("path",{attrs:{d:"M433.3 78.7C413.5 58.9 387.1 48 359 48s-54.6 10.9-74.4 30.7l-63.7 63.7c-9.7 9.7-3.6 26.3 10.1 27.4 4.7.4 9.3-1.3 12.7-4.6l63.8-63.6c13.7-13.7 32-21.2 51.5-21.2s37.8 7.5 51.5 21.2c13.7 13.7 21.2 32 21.2 51.5s-7.5 37.8-21.2 51.5l-68.6 68.6c-3.5 3.5-7.3 6.6-11.4 9.3-4.6 3-9.6 5.6-14.8 7.5-4.8 1.8-9.9 3-15 3.7-3.4.5-6.9.7-10.2.7-1.4 0-2.9-.1-4.6-.2-17.7-1.1-34.4-8.6-46.8-21-7.3-7.3-12.8-16-16.4-25.5-2.9-7.7-11.1-11.9-19.1-9.8-8.9 2.3-14.1 11.7-11.3 20.5 4.5 14 12.1 25.9 23.7 37.5l.2.2c16.9 16.9 39.4 27.6 63.3 30.1 3.7.4 7.4.6 11.1.6 2.6 0 5.2-.1 7.8-.3 6.5-.5 13-1.6 19.3-3.2 6.7-1.8 13.3-4.2 19.5-7.3 10.3-5.1 19.6-11.7 27.7-19.9l68.6-68.6c19.8-19.8 30.7-46.2 30.7-74.4s-11.1-54.6-30.9-74.4z"}})])]),t._v(" 2. Modifying the markdown parser")]),t._v(" "),n("p",[t._v("The plan here was to manually change the theme, and then write a markdown plugin to transform the images within a post. I was never able to figure out where the hell the markdown parsing was done within Ghost's core.")]),t._v(" "),n("h4",{attrs:{id:"3-implement-cloudfare-html-rewriting"}},[n("a",{staticClass:"md-headingAnchor",attrs:{href:"#3-implement-cloudfare-html-rewriting","aria-hidden":"true"}},[n("svg",{attrs:{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 512 512"}},[n("path",{attrs:{d:"M280 341.1l-1.2.1c-3.6.4-7 2-9.6 4.5l-64.6 64.6c-13.7 13.7-32 21.2-51.5 21.2s-37.8-7.5-51.5-21.2c-13.7-13.7-21.2-32-21.2-51.5s7.5-37.8 21.2-51.5l68.6-68.6c3.5-3.5 7.3-6.6 11.4-9.3 4.6-3 9.6-5.6 14.8-7.5 4.8-1.8 9.9-3 15-3.7 3.4-.5 6.9-.7 10.2-.7 1.4 0 2.8.1 4.6.2 17.7 1.1 34.4 8.6 46.8 21 7.7 7.7 13.6 17.1 17.1 27.3 2.8 8 11.2 12.5 19.3 10.1.1 0 .2-.1.3-.1.1 0 .2 0 .2-.1 8.1-2.5 12.8-11 10.5-19.1-4.4-15.6-12.2-28.7-24.6-41-15.6-15.6-35.9-25.8-57.6-29.3-1.9-.3-3.8-.6-5.7-.8-3.7-.4-7.4-.6-11.1-.6-2.6 0-5.2.1-7.7.3-5.4.4-10.8 1.2-16.2 2.5-1.1.2-2.1.5-3.2.8-6.7 1.8-13.3 4.2-19.5 7.3-10.3 5.1-19.6 11.7-27.7 19.9l-68.6 68.6C58.9 304.4 48 330.8 48 359c0 28.2 10.9 54.6 30.7 74.4C98.5 453.1 124.9 464 153 464c28.2 0 54.6-10.9 74.4-30.7l65.3-65.3c10.4-10.5 2-28.3-12.7-26.9z"}}),n("path",{attrs:{d:"M433.3 78.7C413.5 58.9 387.1 48 359 48s-54.6 10.9-74.4 30.7l-63.7 63.7c-9.7 9.7-3.6 26.3 10.1 27.4 4.7.4 9.3-1.3 12.7-4.6l63.8-63.6c13.7-13.7 32-21.2 51.5-21.2s37.8 7.5 51.5 21.2c13.7 13.7 21.2 32 21.2 51.5s-7.5 37.8-21.2 51.5l-68.6 68.6c-3.5 3.5-7.3 6.6-11.4 9.3-4.6 3-9.6 5.6-14.8 7.5-4.8 1.8-9.9 3-15 3.7-3.4.5-6.9.7-10.2.7-1.4 0-2.9-.1-4.6-.2-17.7-1.1-34.4-8.6-46.8-21-7.3-7.3-12.8-16-16.4-25.5-2.9-7.7-11.1-11.9-19.1-9.8-8.9 2.3-14.1 11.7-11.3 20.5 4.5 14 12.1 25.9 23.7 37.5l.2.2c16.9 16.9 39.4 27.6 63.3 30.1 3.7.4 7.4.6 11.1.6 2.6 0 5.2-.1 7.8-.3 6.5-.5 13-1.6 19.3-3.2 6.7-1.8 13.3-4.2 19.5-7.3 10.3-5.1 19.6-11.7 27.7-19.9l68.6-68.6c19.8-19.8 30.7-46.2 30.7-74.4s-11.1-54.6-30.9-74.4z"}})])]),t._v(" 3. Implement cloudfare html rewriting")]),t._v(" "),n("p",[t._v("You can somehow hook up cloudflare to a website and rewrite the html. I almost like this solution, but apparently it wasn't possible with the setup we were using.")]),t._v(" "),t._m(4),t._v(" "),n("h3",{attrs:{id:"the-actual-working-solution"}},[n("a",{staticClass:"md-headingAnchor",attrs:{href:"#the-actual-working-solution","aria-hidden":"true"}},[n("svg",{attrs:{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 512 512"}},[n("path",{attrs:{d:"M280 341.1l-1.2.1c-3.6.4-7 2-9.6 4.5l-64.6 64.6c-13.7 13.7-32 21.2-51.5 21.2s-37.8-7.5-51.5-21.2c-13.7-13.7-21.2-32-21.2-51.5s7.5-37.8 21.2-51.5l68.6-68.6c3.5-3.5 7.3-6.6 11.4-9.3 4.6-3 9.6-5.6 14.8-7.5 4.8-1.8 9.9-3 15-3.7 3.4-.5 6.9-.7 10.2-.7 1.4 0 2.8.1 4.6.2 17.7 1.1 34.4 8.6 46.8 21 7.7 7.7 13.6 17.1 17.1 27.3 2.8 8 11.2 12.5 19.3 10.1.1 0 .2-.1.3-.1.1 0 .2 0 .2-.1 8.1-2.5 12.8-11 10.5-19.1-4.4-15.6-12.2-28.7-24.6-41-15.6-15.6-35.9-25.8-57.6-29.3-1.9-.3-3.8-.6-5.7-.8-3.7-.4-7.4-.6-11.1-.6-2.6 0-5.2.1-7.7.3-5.4.4-10.8 1.2-16.2 2.5-1.1.2-2.1.5-3.2.8-6.7 1.8-13.3 4.2-19.5 7.3-10.3 5.1-19.6 11.7-27.7 19.9l-68.6 68.6C58.9 304.4 48 330.8 48 359c0 28.2 10.9 54.6 30.7 74.4C98.5 453.1 124.9 464 153 464c28.2 0 54.6-10.9 74.4-30.7l65.3-65.3c10.4-10.5 2-28.3-12.7-26.9z"}}),n("path",{attrs:{d:"M433.3 78.7C413.5 58.9 387.1 48 359 48s-54.6 10.9-74.4 30.7l-63.7 63.7c-9.7 9.7-3.6 26.3 10.1 27.4 4.7.4 9.3-1.3 12.7-4.6l63.8-63.6c13.7-13.7 32-21.2 51.5-21.2s37.8 7.5 51.5 21.2c13.7 13.7 21.2 32 21.2 51.5s-7.5 37.8-21.2 51.5l-68.6 68.6c-3.5 3.5-7.3 6.6-11.4 9.3-4.6 3-9.6 5.6-14.8 7.5-4.8 1.8-9.9 3-15 3.7-3.4.5-6.9.7-10.2.7-1.4 0-2.9-.1-4.6-.2-17.7-1.1-34.4-8.6-46.8-21-7.3-7.3-12.8-16-16.4-25.5-2.9-7.7-11.1-11.9-19.1-9.8-8.9 2.3-14.1 11.7-11.3 20.5 4.5 14 12.1 25.9 23.7 37.5l.2.2c16.9 16.9 39.4 27.6 63.3 30.1 3.7.4 7.4.6 11.1.6 2.6 0 5.2-.1 7.8-.3 6.5-.5 13-1.6 19.3-3.2 6.7-1.8 13.3-4.2 19.5-7.3 10.3-5.1 19.6-11.7 27.7-19.9l68.6-68.6c19.8-19.8 30.7-46.2 30.7-74.4s-11.1-54.6-30.9-74.4z"}})])]),t._v(" The actual working solution")]),t._v(" "),n("p",[t._v("The solution requires modifying a small part of 1 file in ghost's core. Basically, the express route handler is changed so that we can transform the html before it's sent. This means all images throughout the site are lazy loaded.")]),t._v(" "),t._m(5),t._v(" "),t._m(6),t._v(" "),t._m(7),t._v(" "),t._m(8),t._v(" "),t._m(9),t._v(" "),t._m(10),t._v(" "),n("h3",{attrs:{id:"but-perf-tho"}},[n("a",{staticClass:"md-headingAnchor",attrs:{href:"#but-perf-tho","aria-hidden":"true"}},[n("svg",{attrs:{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 512 512"}},[n("path",{attrs:{d:"M280 341.1l-1.2.1c-3.6.4-7 2-9.6 4.5l-64.6 64.6c-13.7 13.7-32 21.2-51.5 21.2s-37.8-7.5-51.5-21.2c-13.7-13.7-21.2-32-21.2-51.5s7.5-37.8 21.2-51.5l68.6-68.6c3.5-3.5 7.3-6.6 11.4-9.3 4.6-3 9.6-5.6 14.8-7.5 4.8-1.8 9.9-3 15-3.7 3.4-.5 6.9-.7 10.2-.7 1.4 0 2.8.1 4.6.2 17.7 1.1 34.4 8.6 46.8 21 7.7 7.7 13.6 17.1 17.1 27.3 2.8 8 11.2 12.5 19.3 10.1.1 0 .2-.1.3-.1.1 0 .2 0 .2-.1 8.1-2.5 12.8-11 10.5-19.1-4.4-15.6-12.2-28.7-24.6-41-15.6-15.6-35.9-25.8-57.6-29.3-1.9-.3-3.8-.6-5.7-.8-3.7-.4-7.4-.6-11.1-.6-2.6 0-5.2.1-7.7.3-5.4.4-10.8 1.2-16.2 2.5-1.1.2-2.1.5-3.2.8-6.7 1.8-13.3 4.2-19.5 7.3-10.3 5.1-19.6 11.7-27.7 19.9l-68.6 68.6C58.9 304.4 48 330.8 48 359c0 28.2 10.9 54.6 30.7 74.4C98.5 453.1 124.9 464 153 464c28.2 0 54.6-10.9 74.4-30.7l65.3-65.3c10.4-10.5 2-28.3-12.7-26.9z"}}),n("path",{attrs:{d:"M433.3 78.7C413.5 58.9 387.1 48 359 48s-54.6 10.9-74.4 30.7l-63.7 63.7c-9.7 9.7-3.6 26.3 10.1 27.4 4.7.4 9.3-1.3 12.7-4.6l63.8-63.6c13.7-13.7 32-21.2 51.5-21.2s37.8 7.5 51.5 21.2c13.7 13.7 21.2 32 21.2 51.5s-7.5 37.8-21.2 51.5l-68.6 68.6c-3.5 3.5-7.3 6.6-11.4 9.3-4.6 3-9.6 5.6-14.8 7.5-4.8 1.8-9.9 3-15 3.7-3.4.5-6.9.7-10.2.7-1.4 0-2.9-.1-4.6-.2-17.7-1.1-34.4-8.6-46.8-21-7.3-7.3-12.8-16-16.4-25.5-2.9-7.7-11.1-11.9-19.1-9.8-8.9 2.3-14.1 11.7-11.3 20.5 4.5 14 12.1 25.9 23.7 37.5l.2.2c16.9 16.9 39.4 27.6 63.3 30.1 3.7.4 7.4.6 11.1.6 2.6 0 5.2-.1 7.8-.3 6.5-.5 13-1.6 19.3-3.2 6.7-1.8 13.3-4.2 19.5-7.3 10.3-5.1 19.6-11.7 27.7-19.9l68.6-68.6c19.8-19.8 30.7-46.2 30.7-74.4s-11.1-54.6-30.9-74.4z"}})])]),t._v(" But perf tho?")]),t._v(" "),t._m(11)])}),[function(){var t=this.$createElement,e=this._self._c||t;return e("p",[this._v("Lazy loading images doesn't come with Ghost out of the box, so if you want it then you have to figure out a solution yourself. Pretty much all of the solutions found online boil down to modifying the theme and the posts themselves. Modifying the theme isn't a big deal, but for the blog I was helping on, "),e("a",{attrs:{href:"https://modernfertility.com/blog/"}},[this._v("modernfertility.com/blog")]),this._v(", there were simply too many posts that modifying them was out of the picture.")])},function(){var t=this.$createElement,e=this._self._c||t;return e("span",{staticClass:"hljs-tag"},[this._v("<"),e("span",{staticClass:"hljs-name"},[this._v("main")]),this._v(">")])},function(){var t=this.$createElement,e=this._self._c||t;return e("span",{staticClass:"hljs-tag"},[this._v("</"),e("span",{staticClass:"hljs-name"},[this._v("main")]),this._v(">")])},function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("ol",[n("li",[t._v("Ghost doesn't seem to allow user defined apps. If you want to create an app, you have to add a folder to "),n("code",[t._v("current/core/frontend/apps")]),t._v(". Then add the name of the folder to the "),n("code",[t._v("apps.internal")]),t._v(' array in a file called "overrides.json".')]),t._v(" "),n("li",[t._v("Transforming a page with cheeriojs that uses an asynchronous helper will cause ghost to freeze indefinitely.")]),t._v(" "),n("li",[t._v("Async helpers don't resolve before the helper is run, so there will be bits of html that won't be processed. That's no bueno. The point here is to change all the image tags on the page.")])])},function(){var t=this.$createElement,e=this._self._c||t;return e("p",[e("a",{attrs:{href:"https://developers.cloudflare.com/workers/reference/apis/html-rewriter/"}},[this._v("Cloudflare HTMLRewriter")])])},function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("pre",{staticClass:"md-codeBlock hljs",attrs:{"data-lang":"js"}},[n("code",{staticClass:"hljs-inner md-codeBlockInner"},[n("span",{staticClass:"hljs-keyword"},[t._v("const")]),t._v(" {\n  compose,\n  getHtml,\n  loadHtml,\n  transformLazify,\n} = "),n("span",{staticClass:"hljs-built_in"},[t._v("require")]),t._v("("),n("span",{staticClass:"hljs-string"},[t._v("'../../../../../utils/lazyload'")]),t._v(")\n\n"),n("span",{staticClass:"hljs-keyword"},[t._v("const")]),t._v(" transform = compose(\n  "),n("span",{staticClass:"hljs-function"},[n("span",{staticClass:"hljs-params"},[t._v("html")]),t._v(" =>")]),t._v(" loadHtml(html),\n  transformLazify,\n  getHtml,\n)\n\n"),n("span",{staticClass:"hljs-comment"},[t._v("// ... bunch of stuff")]),t._v("\n\n"),n("span",{staticClass:"hljs-comment"},[t._v("/**\n * @description Helper function to finally render the data.\n * @param {Object} req\n * @param {Object} res\n * @param {Object} data\n */")]),t._v("\n"),n("span",{staticClass:"hljs-built_in"},[t._v("module")]),t._v(".exports = "),n("span",{staticClass:"hljs-function"},[n("span",{staticClass:"hljs-keyword"},[t._v("function")]),t._v(" "),n("span",{staticClass:"hljs-title"},[t._v("renderer")]),t._v("("),n("span",{staticClass:"hljs-params"},[t._v("req, res, data")]),t._v(") ")]),t._v("{\n  "),n("span",{staticClass:"hljs-comment"},[t._v("// Set response context")]),t._v("\n  setContext(req, res, data)\n\n  "),n("span",{staticClass:"hljs-comment"},[t._v("// Set template")]),t._v("\n  templates.setTemplate(req, res, data)\n\n  debug("),n("span",{staticClass:"hljs-string"},[t._v("'Rendering template: '")]),t._v(" + res._template + "),n("span",{staticClass:"hljs-string"},[t._v("' for: '")]),t._v(" + req.originalUrl)\n  debug("),n("span",{staticClass:"hljs-string"},[t._v("'res.locals'")]),t._v(", res.locals)\n\n  "),n("span",{staticClass:"hljs-comment"},[t._v("// CASE: You can set the content type of the page in your routes.yaml file")]),t._v("\n  "),n("span",{staticClass:"hljs-keyword"},[t._v("if")]),t._v(" (res.routerOptions && res.routerOptions.contentType) {\n    "),n("span",{staticClass:"hljs-keyword"},[t._v("if")]),t._v(" (res.routerOptions.templates.indexOf(res._template) !== "),n("span",{staticClass:"hljs-number"},[t._v("-1")]),t._v(") {\n      res.type(res.routerOptions.contentType)\n    }\n  }\n\n  "),n("span",{staticClass:"hljs-comment"},[t._v("// Render Call")]),t._v("\n  res.render(res._template, data, (err, html) => {\n    "),n("span",{staticClass:"hljs-keyword"},[t._v("if")]),t._v(" (err) req.next(err)\n\n    "),n("span",{staticClass:"hljs-keyword"},[t._v("const")]),t._v(" after = transform(html)\n\n    res.send(after)\n  })\n}\n")])])},function(){var t=this.$createElement,e=this._self._c||t;return e("p",[this._v("The "),e("code",[this._v("res.render")]),this._v(" portion is the only part that has been modified. It's actually a very simple change. The majority of the transform code was put into a separate file.")])},function(){var t=this.$createElement,e=this._self._c||t;return e("p",[this._v("To create the transform function, you'll need to create a file lazyload.js (or call it whatever) inside the "),e("code",[this._v("current/")]),this._v(" directory. We chose to put it in "),e("code",[this._v("current/utils/lazyload.js")]),this._v(". It can't be outside of the "),e("code",[this._v("current/")]),this._v(" folder because node won't be able to require it.")])},function(){var t=this.$createElement,e=this._self._c||t;return e("p",[this._v("As for the actual content, our lazifying file does some extra stuff, but I've put the "),e("a",{attrs:{href:"https://gist.github.com/anthonykoch/d7b84adcaa2be2412c14bb2b5de6cdb8"}},[this._v("stripped down version of it into a gist")]),this._v(".")])},function(){var t=this.$createElement,e=this._self._c||t;return e("div",[e("div",{staticClass:"Aside"},[e("div",{staticClass:"Aside-content"},[e("div",{staticClass:"Aside-tag  [ Tag is-absolute ]"},[this._v("Note")]),this._v("\n      With the version of ghost as of this writing, cheeriojs is already installed, so you don't need to "),e("code",[this._v("npm i cheeriojs")])])])])},function(){var t=this.$createElement,e=this._self._c||t;return e("p",[this._v("Lastly, we added a lazy loader to the frontend to actually load the images in. We went with "),e("a",{attrs:{href:"https://www.npmjs.com/package/vanilla-lazyload"}},[this._v("vanilla-lazyload")]),this._v(" because it's simple to use and only "),e("strong",[this._v("6.5KB minified")]),this._v(". The only thing I don't like is that it doesn't add a loaded class to background-image elements.")])},function(){var t=this.$createElement,e=this._self._c||t;return e("p",[this._v("A "),e("code",[this._v("console.time()")]),this._v(" around the "),e("code",[this._v("transform(html)")]),this._v(" bit measured an average of "),e("strong",[this._v("7ms")]),this._v(". Not a super big deal, imo. We were doing a couple more things in our transform, so it should even be less than that. Perhaps if you had a large DOM, (maybe because of syntax highlighted code blocks or something), it could potentially be much higher.")])}],!1,null,null,null);e.default=component.exports}}]);