<!doctype html>
<html data-n-head-ssr data-n-head="">
  <head>
    <title data-n-head="true">Medium style image loading</title><meta data-n-head="true" charset="utf-8"><meta data-n-head="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-n-head="true" data-hid="description" name="description" content="Freelance front-end web developer producing high quality work with an exceptional eye for detail. Mentor. Lover of JavaScript."><meta data-n-head="true" http-equiv="X-UA-Compatible" content="IE=edge"><meta data-n-head="true" name="robots" content="index,follow"><link data-n-head="true" rel="icon" type="image/x-icon" href="/favicon.ico"><link data-n-head="true" rel="stylesheet" href="https://use.typekit.net/nsr0hmh.css"><link data-n-head="true" rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/github.min.css"><script data-n-head="true" async src="//assets.codepen.io/assets/embed/ei.js"></script><link rel="preload" href="/_nuxt/fb0edb8507785c3f920b.js" as="script"><link rel="preload" href="/_nuxt/939af23866584e38578e.js" as="script"><link rel="preload" href="/_nuxt/618ef3dd2a507e0bd94f.js" as="script"><link rel="preload" href="/_nuxt/c2b0ed7da60d58287e2b.css" as="style"><link rel="preload" href="/_nuxt/33e2ccdd4d1bd71f9ba2.js" as="script"><link rel="preload" href="/_nuxt/e77860e6bbac41e8990e.js" as="script"><link rel="preload" href="/_nuxt/c2b0ed7da60d58287e2b.css" as="style"><link rel="stylesheet" href="/_nuxt/c2b0ed7da60d58287e2b.css"><link rel="stylesheet" href="/_nuxt/0e4338761429b4eb16ac.css"><link rel="stylesheet" href="/_nuxt/86a40c57a582459016dc.css">
  </head>
  <body data-n-head="">
    <div data-server-rendered="true" id="__nuxt"><div id="__layout"><div class="Page"><div><div class="Overlay is-light" style="display:none"><div><div tabindex="0"></div> <div tabindex="1"></div> <div data-lock=""><button class="Overlay-close"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path d="M278.6 256l68.2-68.2c6.2-6.2 6.2-16.4 0-22.6-6.2-6.2-16.4-6.2-22.6 0L256 233.4l-68.2-68.2c-6.2-6.2-16.4-6.2-22.6 0-3.1 3.1-4.7 7.2-4.7 11.3 0 4.1 1.6 8.2 4.7 11.3l68.2 68.2-68.2 68.2c-3.1 3.1-4.7 7.2-4.7 11.3 0 4.1 1.6 8.2 4.7 11.3 6.2 6.2 16.4 6.2 22.6 0l68.2-68.2 68.2 68.2c6.2 6.2 16.4 6.2 22.6 0 6.2-6.2 6.2-16.4 0-22.6L278.6 256z"></path></svg></button> <div style="overflow:auto"><img src="data:image/gif;base64,R0lGODlhAQABAIAAAP///wAAACH5BAEAAAAALAAAAAABAAEAAAICRAEAOw==" alt="" class="Image is-fullscreen" style="display:none"></div></div> <div tabindex="0"></div></div></div></div> <div class="BlogToolbar"><div style="display:none"><div></div> <div><button title="Back to top" class="BlogToolbar-backToTop BlogToolbar-button"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 205 328"><path d="M195.7 94.8c-3.1 3.1-8 3-11.3 0L110 28.4V313c0 4.4-3.6 8-8 8s-8-3.6-8-8V28.4L19.6 94.7c-3.4 2.9-8.1 3.2-11.2.1-3.1-3.1-3.3-8.5-.1-11.4 0 0 87-79.2 88-80S99.1 1 102 1s4.9 1.6 5.7 2.4 88 80 88 80c1.5 1.5 2.3 3.6 2.3 5.7s-.8 4.1-2.3 5.7z"></path></svg></button></div></div></div> <div class="Sidebar"><div class="Sidebar-inner"><a href="/blog/understanding-javascript-prototypes" class="SidebarButton u-mb3"><span class="SidebarButton-upper">Next:</span> <span class="SidebarButton-lower">Understanding JavaScript Prototypes</span></a> <a href="/blog/why-you-shouldnt-loop-arrays-with-for-in" class="SidebarButton u-mb3"><span class="SidebarButton-upper">Previous:</span> <span class="SidebarButton-lower">Why you shouldn't loop arrays with for-in</span></a> <div class="Sidebar-footer u-textCenter"><!----> <ul class="IconList"><li class="IconList-item"><a href="http://codepen.io/anthonykoch" title="Codepen" class="IconList-link"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path d="M241.239 303.936c-15.322-10.357-30.742-20.569-46.062-30.93-2.03-1.373-3.43-1.472-5.502-.029l-38.871 26.154C181.966 319.905 244 361.317 244 361.317v-53.786c-.012-1.224-1.553-2.78-2.761-3.595zM195.092 240.666c15.454-10.16 30.851-20.409 46.109-30.86 1.486-1.018 2.775-3.509 2.799-5.334v-51.706s-62.033 41.124-93.262 61.942c13.7 9.159 26.671 17.913 39.787 26.443 1.02.662 3.396.284 4.567-.485zM269.838 209.354a4521.517 4521.517 0 0 0 47.627 31.815c.916.604 2.92.602 3.839 0l39.751-26.467L268 152.484v53.35c.01 1.201.805 2.821 1.838 3.52zM258.109 230.369c-1.21-.802-3.611-.528-4.743.168-4.817 2.962-9.463 6.203-14.164 9.355-8.248 5.53-25.356 17.023-25.356 17.023l38.842 25.865c1.748 1.157 4.436 1.22 6.26.111l39.014-25.993c.001 0-34.079-22.701-39.853-26.529zM141 237.116v39.609l29.622-19.838z"></path><path d="M256 32C132.288 32 32 132.288 32 256s100.288 224 224 224 224-100.288 224-224S379.712 32 256 32zm139 265.006c0 5.785-2.652 9.868-7.511 13.094a38019.909 38019.909 0 0 0-123.286 82.188c-5.854 3.918-11.174 3.754-16.984-.137-40.783-27.314-81.719-54.546-122.625-81.676-5.11-3.389-7.594-7.557-7.594-13.73v-79.729c0-6.141 2.521-10.332 7.624-13.716 40.906-27.13 81.939-54.363 122.724-81.676 5.818-3.896 11.094-4.007 16.938-.095a41090.004 41090.004 0 0 0 123.261 82.195c4.678 3.106 7.453 6.943 7.453 12.66v80.622z"></path><path d="M316.247 273.234a3826.352 3826.352 0 0 1-45.386 30.332c-2.412 1.588-2.888 3.318-2.861 6.189v51.346l93.039-62.004-38.527-25.882c-2.345-1.604-3.93-1.567-6.265.019zM370 276.676V237.06l-29.59 19.873z"></path></svg></a></li> <li class="IconList-item"><a href="https://github.com/anthonykoch" title="Github" class="IconList-link"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path d="M178.354,287.478c-9.123,0-16.928,4.207-23.201,12.833c-6.291,8.478-9.398,18.973-9.398,31.431 c0,12.474,3.166,23.008,9.398,31.509c6.273,8.54,14.039,12.771,23.201,12.771c8.494,0,15.889-4.27,22.121-12.771 c6.271-8.501,9.398-19.035,9.398-31.509c0-12.419-3.166-22.93-9.398-31.431C194.242,291.724,186.908,287.478,178.354,287.478z"></path> <path d="M334.668,287.478c-9.045,0-16.891,4.207-23.182,12.833c-6.271,8.478-9.359,18.973-9.359,31.431 c0,12.474,3.186,23.008,9.359,31.509c6.291,8.54,14.098,12.771,23.182,12.771c8.533,0,15.906-4.27,22.178-12.771 c6.293-8.501,9.418-19.035,9.418-31.509c0-12.419-3.164-22.93-9.418-31.431C350.574,291.724,343.299,287.478,334.668,287.478z"></path> <path d="M445.777,172h-0.059c0,0,2.793-14.264,0.314-39.18c-2.182-24.916-7.471-47.838-16.123-68.82 c0,0-4.422,0.76-12.76,2.896s-22.08,6.299-40.938,14.768c-18.541,8.54-37.986,19.788-58.297,33.505 c-13.803-3.934-34.408-5.939-61.994-5.939c-26.289,0-46.914,2.012-61.977,5.945c-44.592-30.859-81.832-47.945-112.092-51.175 c-8.594,20.982-13.883,43.991-16.045,68.97c-2.398,24.939,0.432,39.329,0.432,39.329C41.979,198.551,32,236.541,32,267.793 c0,24.244,0.658,46.078,6.125,65.48c5.564,19.31,12.662,35.13,21.098,47.221c8.611,12.121,19.012,22.788,31.576,31.938 c12.467,9.314,23.988,15.962,34.389,20.216c10.461,4.372,22.375,7.602,35.982,9.861c13.33,2.386,23.438,3.645,30.477,3.996 c0,0,28,1.494,64.354,1.494c36.354,0,64.295-1.494,64.295-1.494c7.02-0.352,17.145-1.634,30.535-3.996 c13.547-2.299,25.521-5.607,35.941-9.861c10.402-4.293,21.943-10.901,34.469-20.216c12.523-9.032,22.906-19.739,31.518-31.938 c8.436-12.091,15.494-27.911,21.098-47.221c5.486-19.402,6.145-41.385,6.145-65.629C480,237.389,469.982,199,445.777,172z M380.383,405.645C352.521,418.736,311.486,424,257.061,424l-2.143-0.039c-54.443,0-95.361-5.248-122.848-18.41 c-27.508-13.092-41.271-40.057-41.271-80.738c0-24.33,8.572-43.99,25.482-59.107c7.354-6.515,16.438-11.019,27.645-13.717 c11.129-2.558,21.354-2.762,30.969-2.465c9.398,0.415,22.551,2.196,39.344,3.464C231.029,254.285,243.535,256,256,256 c11.698,0,27.213-1.957,52.104-3.959c24.99-1.971,43.494-2.971,55.467-1c12.289,2.002,22.986,6.202,32.129,14.742 c17.734,15.751,26.602,35.505,26.602,59.084C422.301,365.533,408.164,392.537,380.383,405.645z"></path></svg></a></li> <li class="IconList-item"><a href="https://twitter.com/anthkoch" title="Twitter" class="IconList-link"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path d="M492 109.5c-17.4 7.7-36 12.9-55.6 15.3 20-12 35.4-31 42.6-53.6-18.7 11.1-39.4 19.2-61.5 23.5C399.8 75.8 374.6 64 346.8 64c-53.5 0-96.8 43.4-96.8 96.9 0 7.6.8 15 2.5 22.1-80.5-4-151.9-42.6-199.6-101.3-8.3 14.3-13.1 31-13.1 48.7 0 33.6 17.2 63.3 43.2 80.7-16-.4-31-4.8-44-12.1v1.2c0 47 33.4 86.1 77.7 95-8.1 2.2-16.7 3.4-25.5 3.4-6.2 0-12.3-.6-18.2-1.8 12.3 38.5 48.1 66.5 90.5 67.3-33.1 26-74.9 41.5-120.3 41.5-7.8 0-15.5-.5-23.1-1.4C62.8 432 113.7 448 168.3 448 346.6 448 444 300.3 444 172.2c0-4.2-.1-8.4-.3-12.5C462.6 146 479 129 492 109.5z"></path></svg></a></li></ul></div></div></div> <div class="Page-inner"><div><header role="banner" data-page="TODO" class="SiteHeader has-blogBackground is-collapsed"><div class="SiteHeader-container"><div class="Logo"><a href="/" class="Logo-link u-px6 is-dark is-fixed is-active"><span>Anthony </span> <span>Koch</span></a></div> <nav role="navigation" class="SiteNav"><ul class="SiteNav-list"><li class="SiteNav-listItem"><a href="/#work" class="SiteNav-link is-dark">
            work
          </a></li><li class="SiteNav-listItem"><a href="/blog" class="SiteNav-link is-dark">
            blog
          </a></li><li class="SiteNav-listItem"><a href="/contact" class="SiteNav-link is-dark">
            contact
          </a></li> <li class="SiteNav-listItem has-icon"><a href="https://github.com/anthonykoch?tab=repositories" target="_blank" rel="noopener noreferrer" class="SiteNav-iconLink is-github is-dark"><svg fill="rgba(255,255,255,0.8)" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path d="M178.354,287.478c-9.123,0-16.928,4.207-23.201,12.833c-6.291,8.478-9.398,18.973-9.398,31.431 c0,12.474,3.166,23.008,9.398,31.509c6.273,8.54,14.039,12.771,23.201,12.771c8.494,0,15.889-4.27,22.121-12.771 c6.271-8.501,9.398-19.035,9.398-31.509c0-12.419-3.166-22.93-9.398-31.431C194.242,291.724,186.908,287.478,178.354,287.478z"></path> <path d="M334.668,287.478c-9.045,0-16.891,4.207-23.182,12.833c-6.271,8.478-9.359,18.973-9.359,31.431 c0,12.474,3.186,23.008,9.359,31.509c6.291,8.54,14.098,12.771,23.182,12.771c8.533,0,15.906-4.27,22.178-12.771 c6.293-8.501,9.418-19.035,9.418-31.509c0-12.419-3.164-22.93-9.418-31.431C350.574,291.724,343.299,287.478,334.668,287.478z"></path> <path d="M445.777,172h-0.059c0,0,2.793-14.264,0.314-39.18c-2.182-24.916-7.471-47.838-16.123-68.82 c0,0-4.422,0.76-12.76,2.896s-22.08,6.299-40.938,14.768c-18.541,8.54-37.986,19.788-58.297,33.505 c-13.803-3.934-34.408-5.939-61.994-5.939c-26.289,0-46.914,2.012-61.977,5.945c-44.592-30.859-81.832-47.945-112.092-51.175 c-8.594,20.982-13.883,43.991-16.045,68.97c-2.398,24.939,0.432,39.329,0.432,39.329C41.979,198.551,32,236.541,32,267.793 c0,24.244,0.658,46.078,6.125,65.48c5.564,19.31,12.662,35.13,21.098,47.221c8.611,12.121,19.012,22.788,31.576,31.938 c12.467,9.314,23.988,15.962,34.389,20.216c10.461,4.372,22.375,7.602,35.982,9.861c13.33,2.386,23.438,3.645,30.477,3.996 c0,0,28,1.494,64.354,1.494c36.354,0,64.295-1.494,64.295-1.494c7.02-0.352,17.145-1.634,30.535-3.996 c13.547-2.299,25.521-5.607,35.941-9.861c10.402-4.293,21.943-10.901,34.469-20.216c12.523-9.032,22.906-19.739,31.518-31.938 c8.436-12.091,15.494-27.911,21.098-47.221c5.486-19.402,6.145-41.385,6.145-65.629C480,237.389,469.982,199,445.777,172z M380.383,405.645C352.521,418.736,311.486,424,257.061,424l-2.143-0.039c-54.443,0-95.361-5.248-122.848-18.41 c-27.508-13.092-41.271-40.057-41.271-80.738c0-24.33,8.572-43.99,25.482-59.107c7.354-6.515,16.438-11.019,27.645-13.717 c11.129-2.558,21.354-2.762,30.969-2.465c9.398,0.415,22.551,2.196,39.344,3.464C231.029,254.285,243.535,256,256,256 c11.698,0,27.213-1.957,52.104-3.959c24.99-1.971,43.494-2.971,55.467-1c12.289,2.002,22.986,6.202,32.129,14.742 c17.734,15.751,26.602,35.505,26.602,59.084C422.301,365.533,408.164,392.537,380.383,405.645z"></path></svg></a></li></ul></nav></div> <div class="SiteHeader-lower"></div></header> <div class="Page-content has-sidebar">  <article id="post" class="Post"><div class="Post__container"><header class="Post-header u-gutter"><div class="u-sizeReadable u-mxauto"><h1 class="Post-title"><a href="/blog/medium-style-images" class="Link is-dark">
                Medium style image loading
              </a></h1> <p class="PostMeta"><span class="PostMeta-date">
              January, 6 2016
            </span> <span class="PostMeta-author">
              by Anthony Koch
            </span></p></div></header> <div><div class="Post-body md" style="animation-delay:.3s"><p>I was on the <a href="https://medium.com/">Medium</a> website and noticed a cool effect  they do when they lazy load their images. The image first appears blurry, and then slowly unblurs or fades out to reveal the actual image. I thought this was pretty cool, and wanted to see if I could achieve a similar effect.</p>
<!-- endexcerpt -->
<h3 id="the-parts">The parts</h3>
<p>I believe the component that does this is called "ProgressiveMedia". The parts of the component are a canvas element, a thumbnail image (which I will refer to as "thumbnail"), and the actual image (which I will refer to as "image"). There is also an element we will call "aspect ratio fill", which I'll get to later.</p>
<pre class="hljs"><code><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"aspect-ratio-fill"</span>></span>

	<span class="hljs-comment">&lt;!-- The component --></span>
	<span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"ProgressiveMedia"</span>></span>

		<span class="hljs-comment">&lt;!-- The canvas --></span>
		<span class="hljs-tag">&lt;<span class="hljs-name">canvas</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"ProgressiveMedia-canvas"</span> <span class="hljs-attr">width</span>=<span class="hljs-string">"75"</span> <span class="hljs-attr">height</span>=<span class="hljs-string">"38"</span>></span><span class="hljs-tag">&lt;/<span class="hljs-name">canvas</span>></span>

		<span class="hljs-comment">&lt;!-- The thumbnail --></span>
		<span class="hljs-tag">&lt;<span class="hljs-name">img</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"ProgressiveMedia-thumbnail"</span> <span class="hljs-attr">src</span>=<span class="hljs-string">"/scones-thumbnail.jpg"</span> <span class="hljs-attr">alt</span>=<span class="hljs-string">"A thumbnail"</span>></span>

		<span class="hljs-comment">&lt;!-- The image --></span>
		<span class="hljs-tag">&lt;<span class="hljs-name">img</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"ProgressiveMedia-image"</span>
			<span class="hljs-attr">data-src</span>=<span class="hljs-string">"/scones.jpg"</span>
			<span class="hljs-attr">src</span>=<span class="hljs-string">"data:image/gif;base64,R0lGODlhAQABAIAAAP///wAAACH5BAEAAAAALAAAAAABAAEAAAICRAEAOw=="</span>
			<span class="hljs-attr">alt</span>=<span class="hljs-string">"The main image"</span>></span>
	<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>></span>
<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>></span>
</code></pre>
<h4 id="thumbnail">Thumbnail</h4>
<p>The thumbnail is a scaled down version of the original image, around 30px in width. It's important to keep the aspect ratio and to scale the image down proportionately. The thumbnail is an initial substitute of for the actual image that will be shown. Since it's such a small image, its download time should be pretty quick. Now, we don't actually want to see the thumbnail, so it's going to be set to <code>display: none;</code>. The purpose of the thumbnail is to draw it onto the canvas so we can blur it.</p>
<p>We could technically skip the canvas altogether and just use <code>filter: blur(4px);</code>, but the blur filter fades out the edges of the image, which I don't really like.</p>
<h4 id="image-and-canvas">Image and Canvas</h4>
<p>The component, image, and canvas are set to position absolute, with height and width set to 100%, causing them all to expand to the height and width of their container, (with position relative set on the <code>aspect-ratio-fill</code> element so they don't expand outside).</p>
<pre class="hljs"><code><span class="hljs-selector-class">.aspect-ratio-fill</span> {
	<span class="hljs-attribute">position</span>: relative;
}

<span class="hljs-selector-class">.ProgressiveMedia</span>,
<span class="hljs-selector-class">.ProgressiveMedia-canvas</span>,
<span class="hljs-selector-class">.ProgressiveMedia-image</span> {
	<span class="hljs-attribute">position</span>: absolute;
	<span class="hljs-attribute">height</span>: <span class="hljs-number">100%</span>;
	<span class="hljs-attribute">width</span>: <span class="hljs-number">100%</span>;
	<span class="hljs-attribute">left</span>: <span class="hljs-number">0</span>;
	<span class="hljs-attribute">top</span>: <span class="hljs-number">0</span>;
}

<span class="hljs-selector-class">.ProgressiveMedia-image</span> {
	// We will transition the opacity so it fades in nicely
	<span class="hljs-attribute">transition</span>: opacity <span class="hljs-number">0.2s</span>;
	<span class="hljs-attribute">opacity</span>: <span class="hljs-number">0</span>;
	// The image is z-indexed over the canvas
	<span class="hljs-attribute">z-index</span>: <span class="hljs-number">1</span>;
}

// <span class="hljs-selector-tag">When</span> <span class="hljs-selector-tag">the</span> <span class="hljs-selector-tag">image</span> <span class="hljs-selector-tag">is</span> <span class="hljs-selector-tag">loaded</span>, <span class="hljs-selector-tag">fade</span> <span class="hljs-selector-tag">in</span> <span class="hljs-selector-tag">the</span> <span class="hljs-selector-tag">image</span>
<span class="hljs-selector-class">.ProgressiveMedia-image</span><span class="hljs-selector-class">.isLoaded</span> {
	<span class="hljs-attribute">opacity</span>: <span class="hljs-number">1</span>;
}

<span class="hljs-selector-class">.ProgressiveMedia-thumbnail</span> {
	<span class="hljs-attribute">display</span>: none;
}
</code></pre>
<p>Since the point of this is to lazy load images, the src of the image is initially set to a small transparent image. In the HTML example above, I've used an image <a href="https://css-tricks.com/data-uris/">data URI</a> I found on <a href="http://csswizardry.com/2013/01/your-logo-is-still-an-image-and-so-is-mine/">CSSWizardy</a>. There will also need to be a <code>data-src</code> property pointing to the URL of the actual image that we want to show once the actual image has been loaded</p>
<p>From what I can see on the Medium website, the canvas width attribute is usually set to <code>75</code>, and the canvas height attribute is calculated by <code>(75 * height) / width</code>, where the height and width are the real dimensions of the image.</p>
<h4 id="aspect-ratio-fill">Aspect ratio fill</h4>
<p>Since neither the canvas nor the image have their dimensions set, but instead expand to fill their container, a container element somewhere up the line needs to actually have height. Without it, the image and canvas wouldn't have any space to expand in, and as a result wouldn't show.</p>
<p>They way that I see that Medium has done this is with a very clever use of the padding-bottom property set as a percentage. The element the padding is set on is an element with a class name of <code>aspect-ratio-fill</code>.</p>
<pre class="hljs"><code><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"aspect-ratio-fill"</span> <span class="hljs-attr">style</span>=<span class="hljs-string">"padding-bottom: 40%"</span>></span>
	<span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"ProgressiveMedia"</span>></span>
		...
	<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>></span>
<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>></span>
</code></pre>
<p>The padding set on the <code>.aspect-ratio-fill</code> is calculated with the equation below.</p>
<pre><code>var percentage = (image.naturalHeight / image.naturalWidth) * 100;
</code></pre>
<p>It took me some reading and thinking to figure out the math on this, and why it works, but I think I've figured it out. The equation calculates the height of the image relative to the width of the image, expressed as a percentage.  For example, an image that has a height of <code>900px</code>, and a width of <code>1600px</code> calculates to a height of <code>0.5625</code>, because <code>1600px / 900px = 0.5625</code>. But that is in decimal form, and we need it in percentage form, so we multiply it by 100, resulting in <code>56.25%</code>. In other words, the height is <code>56.25%</code> of the width, because <code>0.5625 * 1600</code> equals <code>900</code>.</p>
<p>The reason why setting we set the padding bottom as a percentage is because when padding is set as a percentage, the amount of resulting padding is a percentage of the element's width. For example, if you set a padding bottom of 5%, and the element has a width of <code>900px</code>, the resulting padding bottom the browser will calculate is <code>900px * 0.05</code>, which is <code>45px</code>. It doesn't matter if you set it as padding top, bottom, left or right. The resulting amount of padding is always a percentage of the element's width.</p>
<p>If we set the padding bottom of our <code>aspect-ratio-fill</code> element to the height of the image as a percentage, it will cause the element to have maintain the aspect ratio of the actual image. To test this, let's go back to the <code>1600px by 900px</code> image example. Let's say we have a wrapping element that has a max-width of <code>800px</code> causing our aspect ratio fill element to be restricted to <code>800px</code>. I chose <code>800px</code> as the containing width because it's exactly half of the image's original size, meaning if the aspect ratio is to be preserved, the resulting padding bottom should be exactly half of the image's height. Now, the calculation is the width multiplied by the height percentage, and if we plug in the numbers we get <code>800px * 0.5625 = 450px</code>. Woohoo! We got <code>450px</code>, which is exactly half of the image's height, meaning the aspect ratio has been preserved.</p>
<h3 id="the-process">The process</h3>
<p>In short, the process for lazy loading the image is as follows:</p>
<ol>
<li>Once the thumbnail image has loaded, draw it onto the canvas.</li>
<li>Blur the canvas using StackBlur, which is the library we will use to blur our canvas.</li>
<li>Calculate the padding bottom of the aspect ratio fill element.</li>
<li>Set the src of the of the image to its <code>data-src</code> attribute and wait for it to load.</li>
<li>Once the image has loaded, set a class on the image to fade it in over the canvas.</li>
</ol>
<h4 id="drawing-the-thumbnail">Drawing the thumbnail</h4>
<p>The first part of the process is to draw the thumbnail onto the canvas. So, we grab the thumbnail image and assign it to a thumbnail variable. If the thumbnail image has not yet been loaded, we'll wait for it to load. Once it has been loaded we will draw it onto the canvas using our <code>drawCanvasWithBlur</code> function.</p>
<pre class="hljs"><code><span class="hljs-comment">// The amount we want to blur the canvas</span>
<span class="hljs-keyword">const</span> CANVAS_BLUR_RADIUS = <span class="hljs-number">8</span>;

<span class="hljs-comment">// Grab the elements</span>
<span class="hljs-keyword">var</span> component = <span class="hljs-built_in">document</span>.querySelector(<span class="hljs-string">'.ProgressiveMedia'</span>);
<span class="hljs-keyword">var</span> image     = <span class="hljs-built_in">document</span>.querySelector(<span class="hljs-string">'.ProgressiveMedia-image'</span>);
<span class="hljs-keyword">var</span> canvas    = <span class="hljs-built_in">document</span>.querySelector(<span class="hljs-string">'.ProgressiveMedia-canvas'</span>);
<span class="hljs-keyword">var</span> thumbnail = <span class="hljs-built_in">document</span>.querySelector(<span class="hljs-string">'.ProgressiveMedia-thumbnail'</span>);

<span class="hljs-comment">// Wait for the thumbnail to load if it hasn't</span>
<span class="hljs-keyword">if</span> ( ! thumbnail.complete || thumbnail.naturalWidth === <span class="hljs-number">0</span>) {
	thumbnail.addEventListener(<span class="hljs-string">'load'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">onImageLoaded</span>(<span class="hljs-params"></span>) </span>{
		<span class="hljs-comment">// It's good practice to remove unecessary listeners</span>
		thumbnail.removeEventListener(<span class="hljs-string">'load'</span>, onThumbnailLoad);

		<span class="hljs-comment">// Draw the canvas</span>
		drawCanvasWithBlur(canvas, thumbnail, CANVAS_BLUR_RADIUS);
	});
} <span class="hljs-keyword">else</span> {
	<span class="hljs-comment">// The thumbnail is already loaded, draw it onto the canvas</span>
	drawCanvasWithBlur(canvas, thumbnail, CANVAS_BLUR_RADIUS);
}
</code></pre>
<p>The <code>drawCanvasWithBlur</code> function will look like this. It will accept a canvas element that we want to draw onto, the image element that we want to draw on to the canvas, as well as the amount to blur the canvas.</p>
<pre class="hljs"><code><span class="hljs-comment">/**
 * Draws an image into the canvas. The image can be optionally blurred
 * @param  {Element} canvas     The canvas to draw the image onto
 * @param  {Element} thumbnail  The image used to draw onto the canvas
 * @param  {Number}  blurRadius The amount to blur the canvas
 * @return {void}
 */</span>
<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">drawCanvasWithBlur</span>(<span class="hljs-params">canvas, thumbnail, blurRadius</span>) </span>{
	<span class="hljs-keyword">var</span> context = canvas.getContext(<span class="hljs-string">'2d'</span>);

	<span class="hljs-comment">// Draw the thumbnail onto the canvas</span>
	context.drawImage(thumbnail, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>,

		<span class="hljs-comment">// These two arguments allow the canvas image to scale</span>
		thumbnail.naturalWidth, thumbnail.naturalHeight,

		<span class="hljs-number">0</span>, <span class="hljs-number">0</span>, canvas.width, canvas.height);

	<span class="hljs-comment">// Blur the canvas</span>
	StackBlur.canvasRGBA(canvas, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, canvas.width, canvas.height, blurRadius);
}
</code></pre>
<p><strong>Note:</strong> I'm not really familiar with canvas, so it's very possible I'll be what I'm doing is neither the best way nor the correct way. Also, the code below is just a simple example of how you could do this for one image, and is not meant to be representative example of how to do this for a real website. I imagine the way Medium actually does this is a lot more complicated than this.</p>
<h3 id="setting-the-padding">Setting the padding</h3>
<p>Technically since the thumbnail is scaled down proportionately, keeping the aspect ratio, we can use the height and width of the thumbnail in the calculation of the padding bottom. I imagine you could also calculate the padding server side so that it's set onto the <code>aspect-ratio-fill</code> so that it doesn't shift the layout of the page.</p>
<pre class="hljs"><code><span class="hljs-keyword">var</span> aspectRatioFill = <span class="hljs-built_in">document</span>.querySelector(<span class="hljs-string">'.aspect-ratio-fill'</span>);
<span class="hljs-keyword">var</span> percentage = (thumbnail.naturalHeight / thumbnail.naturalWidth) * <span class="hljs-number">100</span>;
aspectRatioFill.style.paddingBottom = percentage + <span class="hljs-string">'%'</span>;
</code></pre>
<h3 id="loading-the-image">Loading the image</h3>
<p>The next part is to load in the actual image we want to show. We will do this by setting the image's <code>src</code> property to its <code>data-src</code> property. If you remember from earlier, the <code>data-src</code> property is the URL of the actual image. The <code>load</code> event of the image is then watched so that we can set the <code>isLoaded</code> class onto the image once it loads. This will set the opacity of the image to <code>1</code>, and will result in the image being fading in (refer to the CSS near the beginning of the article).</p>
<p>Now, I'm not totally sure if the image should be faded in, the canvas should be faded out, or both. To my eye, they both give a slightly different effect, but for now we'll just fade the image in.</p>
<pre class="hljs"><code><span class="hljs-comment">/* Set the src and then wait till page load */</span>

image.src = image.dataset.src;
image.addEventListener(<span class="hljs-string">'load'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">onImageLoaded</span>(<span class="hljs-params"></span>) </span>{
	image.removeEventListener(<span class="hljs-string">'load'</span>, onImageLoaded);
	image.classList.add(<span class="hljs-string">'isLoaded'</span>);
});
</code></pre>
<p>Once the image has loaded and the class has been added, the image will fade in over the canvas, making it almost appear as if the canvas is slowing being unblurred.</p>
<h3 id="the-finished-product">The finished product</h3>
<p>The example in the codepen demo uses a little bit different code because of it had to be setup for display in codepen.</p>
<div class="md-fullWidth" style="min-height:480px">
  <p data-height="480" data-theme-id="20490" data-slug-hash="WrOQQz" data-default-tab="result" data-user="anthonykoch" class="codepen">See the Pen <a href="http://codepen.io/anthonykoch/pen/WrOQQz/">Medium style image loading</a> by Anthony Koch (<a href="http://codepen.io/anthonykoch">@anthonykoch</a>) on <a href="http://codepen.io">CodePen</a>.</p>
</div>
<h3 id="conclusion">Conclusion</h3>
<p>Although it may not be the exact same as Medium's, I think it's still looks pretty good. There are a number of ways this could be improved if this was  actually used, such as fallbacks for browsers with javascript disabled, but that's outside the scope of this post.</p>
</div></div></div></article></div> <!----></div></div> </div></div></div><script>window.__NUXT__=function(e,a,t,s,n,o,l,i,h,r,c,p,d,u,m,g,f,w,b,y,j,v,x,A,I,k,T){return{layout:"default",data:[{post:{excerpt:{content:g,loc:{start:0,end:322}},author:e,title:I,tags:[k,l,i],id:5,created_at:r,humanized:{created_at:c},url:p,slug:d,next:{url:o,author:e,title:m,tags:[t,f],id:6,created_at:b},previous:{url:y,author:e,title:j,tags:[t,v],id:4,created_at:A},contents:'<p>I was on the <a href="https://medium.com/">Medium</a> website and noticed a cool effect  they do when they lazy load their images. The image first appears blurry, and then slowly unblurs or fades out to reveal the actual image. I thought this was pretty cool, and wanted to see if I could achieve a similar effect.</p>\n\x3c!-- endexcerpt --\x3e\n<h3 id="the-parts">The parts</h3>\n<p>I believe the component that does this is called &quot;ProgressiveMedia&quot;. The parts of the component are a canvas element, a thumbnail image (which I will refer to as &quot;thumbnail&quot;), and the actual image (which I will refer to as &quot;image&quot;). There is also an element we will call &quot;aspect ratio fill&quot;, which I\'ll get to later.</p>\n<pre class="hljs"><code><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"aspect-ratio-fill"</span>&gt;</span>\n\n\t<span class="hljs-comment">&lt;!-- The component --&gt;</span>\n\t<span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"ProgressiveMedia"</span>&gt;</span>\n\n\t\t<span class="hljs-comment">&lt;!-- The canvas --&gt;</span>\n\t\t<span class="hljs-tag">&lt;<span class="hljs-name">canvas</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"ProgressiveMedia-canvas"</span> <span class="hljs-attr">width</span>=<span class="hljs-string">"75"</span> <span class="hljs-attr">height</span>=<span class="hljs-string">"38"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">canvas</span>&gt;</span>\n\n\t\t<span class="hljs-comment">&lt;!-- The thumbnail --&gt;</span>\n\t\t<span class="hljs-tag">&lt;<span class="hljs-name">img</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"ProgressiveMedia-thumbnail"</span> <span class="hljs-attr">src</span>=<span class="hljs-string">"/scones-thumbnail.jpg"</span> <span class="hljs-attr">alt</span>=<span class="hljs-string">"A thumbnail"</span>&gt;</span>\n\n\t\t<span class="hljs-comment">&lt;!-- The image --&gt;</span>\n\t\t<span class="hljs-tag">&lt;<span class="hljs-name">img</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"ProgressiveMedia-image"</span>\n\t\t\t<span class="hljs-attr">data-src</span>=<span class="hljs-string">"/scones.jpg"</span>\n\t\t\t<span class="hljs-attr">src</span>=<span class="hljs-string">"data:image/gif;base64,R0lGODlhAQABAIAAAP///wAAACH5BAEAAAAALAAAAAABAAEAAAICRAEAOw=="</span>\n\t\t\t<span class="hljs-attr">alt</span>=<span class="hljs-string">"The main image"</span>&gt;</span>\n\t<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>\n<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>\n</code></pre>\n<h4 id="thumbnail">Thumbnail</h4>\n<p>The thumbnail is a scaled down version of the original image, around 30px in width. It\'s important to keep the aspect ratio and to scale the image down proportionately. The thumbnail is an initial substitute of for the actual image that will be shown. Since it\'s such a small image, its download time should be pretty quick. Now, we don\'t actually want to see the thumbnail, so it\'s going to be set to <code>display: none;</code>. The purpose of the thumbnail is to draw it onto the canvas so we can blur it.</p>\n<p>We could technically skip the canvas altogether and just use <code>filter: blur(4px);</code>, but the blur filter fades out the edges of the image, which I don\'t really like.</p>\n<h4 id="image-and-canvas">Image and Canvas</h4>\n<p>The component, image, and canvas are set to position absolute, with height and width set to 100%, causing them all to expand to the height and width of their container, (with position relative set on the <code>aspect-ratio-fill</code> element so they don\'t expand outside).</p>\n<pre class="hljs"><code><span class="hljs-selector-class">.aspect-ratio-fill</span> {\n\t<span class="hljs-attribute">position</span>: relative;\n}\n\n<span class="hljs-selector-class">.ProgressiveMedia</span>,\n<span class="hljs-selector-class">.ProgressiveMedia-canvas</span>,\n<span class="hljs-selector-class">.ProgressiveMedia-image</span> {\n\t<span class="hljs-attribute">position</span>: absolute;\n\t<span class="hljs-attribute">height</span>: <span class="hljs-number">100%</span>;\n\t<span class="hljs-attribute">width</span>: <span class="hljs-number">100%</span>;\n\t<span class="hljs-attribute">left</span>: <span class="hljs-number">0</span>;\n\t<span class="hljs-attribute">top</span>: <span class="hljs-number">0</span>;\n}\n\n<span class="hljs-selector-class">.ProgressiveMedia-image</span> {\n\t// We will transition the opacity so it fades in nicely\n\t<span class="hljs-attribute">transition</span>: opacity <span class="hljs-number">0.2s</span>;\n\t<span class="hljs-attribute">opacity</span>: <span class="hljs-number">0</span>;\n\t// The image is z-indexed over the canvas\n\t<span class="hljs-attribute">z-index</span>: <span class="hljs-number">1</span>;\n}\n\n// <span class="hljs-selector-tag">When</span> <span class="hljs-selector-tag">the</span> <span class="hljs-selector-tag">image</span> <span class="hljs-selector-tag">is</span> <span class="hljs-selector-tag">loaded</span>, <span class="hljs-selector-tag">fade</span> <span class="hljs-selector-tag">in</span> <span class="hljs-selector-tag">the</span> <span class="hljs-selector-tag">image</span>\n<span class="hljs-selector-class">.ProgressiveMedia-image</span><span class="hljs-selector-class">.isLoaded</span> {\n\t<span class="hljs-attribute">opacity</span>: <span class="hljs-number">1</span>;\n}\n\n<span class="hljs-selector-class">.ProgressiveMedia-thumbnail</span> {\n\t<span class="hljs-attribute">display</span>: none;\n}\n</code></pre>\n<p>Since the point of this is to lazy load images, the src of the image is initially set to a small transparent image. In the HTML example above, I\'ve used an image <a href="https://css-tricks.com/data-uris/">data URI</a> I found on <a href="http://csswizardry.com/2013/01/your-logo-is-still-an-image-and-so-is-mine/">CSSWizardy</a>. There will also need to be a <code>data-src</code> property pointing to the URL of the actual image that we want to show once the actual image has been loaded</p>\n<p>From what I can see on the Medium website, the canvas width attribute is usually set to <code>75</code>, and the canvas height attribute is calculated by <code>(75 * height) / width</code>, where the height and width are the real dimensions of the image.</p>\n<h4 id="aspect-ratio-fill">Aspect ratio fill</h4>\n<p>Since neither the canvas nor the image have their dimensions set, but instead expand to fill their container, a container element somewhere up the line needs to actually have height. Without it, the image and canvas wouldn\'t have any space to expand in, and as a result wouldn\'t show.</p>\n<p>They way that I see that Medium has done this is with a very clever use of the padding-bottom property set as a percentage. The element the padding is set on is an element with a class name of <code>aspect-ratio-fill</code>.</p>\n<pre class="hljs"><code><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"aspect-ratio-fill"</span> <span class="hljs-attr">style</span>=<span class="hljs-string">"padding-bottom: 40%"</span>&gt;</span>\n\t<span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"ProgressiveMedia"</span>&gt;</span>\n\t\t...\n\t<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>\n<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>\n</code></pre>\n<p>The padding set on the <code>.aspect-ratio-fill</code> is calculated with the equation below.</p>\n<pre><code>var percentage = (image.naturalHeight / image.naturalWidth) * 100;\n</code></pre>\n<p>It took me some reading and thinking to figure out the math on this, and why it works, but I think I\'ve figured it out. The equation calculates the height of the image relative to the width of the image, expressed as a percentage.  For example, an image that has a height of <code>900px</code>, and a width of <code>1600px</code> calculates to a height of <code>0.5625</code>, because <code>1600px / 900px = 0.5625</code>. But that is in decimal form, and we need it in percentage form, so we multiply it by 100, resulting in <code>56.25%</code>. In other words, the height is <code>56.25%</code> of the width, because <code>0.5625 * 1600</code> equals <code>900</code>.</p>\n<p>The reason why setting we set the padding bottom as a percentage is because when padding is set as a percentage, the amount of resulting padding is a percentage of the element\'s width. For example, if you set a padding bottom of 5%, and the element has a width of <code>900px</code>, the resulting padding bottom the browser will calculate is <code>900px * 0.05</code>, which is <code>45px</code>. It doesn\'t matter if you set it as padding top, bottom, left or right. The resulting amount of padding is always a percentage of the element\'s width.</p>\n<p>If we set the padding bottom of our <code>aspect-ratio-fill</code> element to the height of the image as a percentage, it will cause the element to have maintain the aspect ratio of the actual image. To test this, let\'s go back to the <code>1600px by 900px</code> image example. Let\'s say we have a wrapping element that has a max-width of <code>800px</code> causing our aspect ratio fill element to be restricted to <code>800px</code>. I chose <code>800px</code> as the containing width because it\'s exactly half of the image\'s original size, meaning if the aspect ratio is to be preserved, the resulting padding bottom should be exactly half of the image\'s height. Now, the calculation is the width multiplied by the height percentage, and if we plug in the numbers we get <code>800px * 0.5625 = 450px</code>. Woohoo! We got <code>450px</code>, which is exactly half of the image\'s height, meaning the aspect ratio has been preserved.</p>\n<h3 id="the-process">The process</h3>\n<p>In short, the process for lazy loading the image is as follows:</p>\n<ol>\n<li>Once the thumbnail image has loaded, draw it onto the canvas.</li>\n<li>Blur the canvas using StackBlur, which is the library we will use to blur our canvas.</li>\n<li>Calculate the padding bottom of the aspect ratio fill element.</li>\n<li>Set the src of the of the image to its <code>data-src</code> attribute and wait for it to load.</li>\n<li>Once the image has loaded, set a class on the image to fade it in over the canvas.</li>\n</ol>\n<h4 id="drawing-the-thumbnail">Drawing the thumbnail</h4>\n<p>The first part of the process is to draw the thumbnail onto the canvas. So, we grab the thumbnail image and assign it to a thumbnail variable. If the thumbnail image has not yet been loaded, we\'ll wait for it to load. Once it has been loaded we will draw it onto the canvas using our <code>drawCanvasWithBlur</code> function.</p>\n<pre class="hljs"><code><span class="hljs-comment">// The amount we want to blur the canvas</span>\n<span class="hljs-keyword">const</span> CANVAS_BLUR_RADIUS = <span class="hljs-number">8</span>;\n\n<span class="hljs-comment">// Grab the elements</span>\n<span class="hljs-keyword">var</span> component = <span class="hljs-built_in">document</span>.querySelector(<span class="hljs-string">\'.ProgressiveMedia\'</span>);\n<span class="hljs-keyword">var</span> image     = <span class="hljs-built_in">document</span>.querySelector(<span class="hljs-string">\'.ProgressiveMedia-image\'</span>);\n<span class="hljs-keyword">var</span> canvas    = <span class="hljs-built_in">document</span>.querySelector(<span class="hljs-string">\'.ProgressiveMedia-canvas\'</span>);\n<span class="hljs-keyword">var</span> thumbnail = <span class="hljs-built_in">document</span>.querySelector(<span class="hljs-string">\'.ProgressiveMedia-thumbnail\'</span>);\n\n<span class="hljs-comment">// Wait for the thumbnail to load if it hasn\'t</span>\n<span class="hljs-keyword">if</span> ( ! thumbnail.complete || thumbnail.naturalWidth === <span class="hljs-number">0</span>) {\n\tthumbnail.addEventListener(<span class="hljs-string">\'load\'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">onImageLoaded</span>(<span class="hljs-params"></span>) </span>{\n\t\t<span class="hljs-comment">// It\'s good practice to remove unecessary listeners</span>\n\t\tthumbnail.removeEventListener(<span class="hljs-string">\'load\'</span>, onThumbnailLoad);\n\n\t\t<span class="hljs-comment">// Draw the canvas</span>\n\t\tdrawCanvasWithBlur(canvas, thumbnail, CANVAS_BLUR_RADIUS);\n\t});\n} <span class="hljs-keyword">else</span> {\n\t<span class="hljs-comment">// The thumbnail is already loaded, draw it onto the canvas</span>\n\tdrawCanvasWithBlur(canvas, thumbnail, CANVAS_BLUR_RADIUS);\n}\n</code></pre>\n<p>The <code>drawCanvasWithBlur</code> function will look like this. It will accept a canvas element that we want to draw onto, the image element that we want to draw on to the canvas, as well as the amount to blur the canvas.</p>\n<pre class="hljs"><code><span class="hljs-comment">/**\n * Draws an image into the canvas. The image can be optionally blurred\n * @param  {Element} canvas     The canvas to draw the image onto\n * @param  {Element} thumbnail  The image used to draw onto the canvas\n * @param  {Number}  blurRadius The amount to blur the canvas\n * @return {void}\n */</span>\n<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">drawCanvasWithBlur</span>(<span class="hljs-params">canvas, thumbnail, blurRadius</span>) </span>{\n\t<span class="hljs-keyword">var</span> context = canvas.getContext(<span class="hljs-string">\'2d\'</span>);\n\n\t<span class="hljs-comment">// Draw the thumbnail onto the canvas</span>\n\tcontext.drawImage(thumbnail, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>,\n\n\t\t<span class="hljs-comment">// These two arguments allow the canvas image to scale</span>\n\t\tthumbnail.naturalWidth, thumbnail.naturalHeight,\n\n\t\t<span class="hljs-number">0</span>, <span class="hljs-number">0</span>, canvas.width, canvas.height);\n\n\t<span class="hljs-comment">// Blur the canvas</span>\n\tStackBlur.canvasRGBA(canvas, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, canvas.width, canvas.height, blurRadius);\n}\n</code></pre>\n<p><strong>Note:</strong> I\'m not really familiar with canvas, so it\'s very possible I\'ll be what I\'m doing is neither the best way nor the correct way. Also, the code below is just a simple example of how you could do this for one image, and is not meant to be representative example of how to do this for a real website. I imagine the way Medium actually does this is a lot more complicated than this.</p>\n<h3 id="setting-the-padding">Setting the padding</h3>\n<p>Technically since the thumbnail is scaled down proportionately, keeping the aspect ratio, we can use the height and width of the thumbnail in the calculation of the padding bottom. I imagine you could also calculate the padding server side so that it\'s set onto the <code>aspect-ratio-fill</code> so that it doesn\'t shift the layout of the page.</p>\n<pre class="hljs"><code><span class="hljs-keyword">var</span> aspectRatioFill = <span class="hljs-built_in">document</span>.querySelector(<span class="hljs-string">\'.aspect-ratio-fill\'</span>);\n<span class="hljs-keyword">var</span> percentage = (thumbnail.naturalHeight / thumbnail.naturalWidth) * <span class="hljs-number">100</span>;\naspectRatioFill.style.paddingBottom = percentage + <span class="hljs-string">\'%\'</span>;\n</code></pre>\n<h3 id="loading-the-image">Loading the image</h3>\n<p>The next part is to load in the actual image we want to show. We will do this by setting the image\'s <code>src</code> property to its <code>data-src</code> property. If you remember from earlier, the <code>data-src</code> property is the URL of the actual image. The <code>load</code> event of the image is then watched so that we can set the <code>isLoaded</code> class onto the image once it loads. This will set the opacity of the image to <code>1</code>, and will result in the image being fading in (refer to the CSS near the beginning of the article).</p>\n<p>Now, I\'m not totally sure if the image should be faded in, the canvas should be faded out, or both. To my eye, they both give a slightly different effect, but for now we\'ll just fade the image in.</p>\n<pre class="hljs"><code><span class="hljs-comment">/* Set the src and then wait till page load */</span>\n\nimage.src = image.dataset.src;\nimage.addEventListener(<span class="hljs-string">\'load\'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">onImageLoaded</span>(<span class="hljs-params"></span>) </span>{\n\timage.removeEventListener(<span class="hljs-string">\'load\'</span>, onImageLoaded);\n\timage.classList.add(<span class="hljs-string">\'isLoaded\'</span>);\n});\n</code></pre>\n<p>Once the image has loaded and the class has been added, the image will fade in over the canvas, making it almost appear as if the canvas is slowing being unblurred.</p>\n<h3 id="the-finished-product">The finished product</h3>\n<p>The example in the codepen demo uses a little bit different code because of it had to be setup for display in codepen.</p>\n<div class="md-fullWidth" style="min-height: 480px">\n  <p data-height="480" data-theme-id="20490" data-slug-hash="WrOQQz" data-default-tab="result" data-user="anthonykoch" class=\'codepen\'>See the Pen <a href=\'http://codepen.io/anthonykoch/pen/WrOQQz/\'>Medium style image loading</a> by Anthony Koch (<a href=\'http://codepen.io/anthonykoch\'>@anthonykoch</a>) on <a href=\'http://codepen.io\'>CodePen</a>.</p>\n</div>\n<h3 id="conclusion">Conclusion</h3>\n<p>Although it may not be the exact same as Medium\'s, I think it\'s still looks pretty good. There are a number of ways this could be improved if this was  actually used, such as fallbacks for browsers with javascript disabled, but that\'s outside the scope of this post.</p>\n'}}],error:null,state:{projects:{codepen:[{title:"vue-scuffka",video:{url:"/_nuxt/videos/638279d.mp4"},thumbnail:{},icon:{xlinkHref:"icon-octocat"},fade:"white",href:"http://www.anthonykoch.com/vue-scuffka",meta:{},id:"cjng7t3tr0000amyq1bko5yp3"},{title:"Calculator",image:{url:"/_nuxt/img/b6306cd.png"},thumbnail:{},icon:{xlinkHref:s},fade:n,hash:"xVQOwb",href:"http://codepen.io/anthonykoch/pen/xVQOwb",meta:{likes:193},id:"cjng7t3tr0001amyqa1wlmvbj"},{title:"Settings Page",image:{url:"/_nuxt/img/40eeba4.png"},thumbnail:{},icon:{xlinkHref:s},fade:n,hash:"QjJaQv",href:"http://codepen.io/anthonykoch/pen/QjJaQv",meta:{likes:67},id:"cjng7t3tr0002amyq20td7x95"},{title:"Medium Image Loading",image:{url:"/_nuxt/img/481d2f0.png"},thumbnail:{},icon:{xlinkHref:s},fade:n,hash:"WrOQQz",href:"http://codepen.io/anthonykoch/pen/WrOQQz",meta:{likes:77},id:"cjng7t3tr0003amyq4zw9j2g9"},{title:"Smart Home UI",image:{url:"/_nuxt/img/ed77829.png"},thumbnail:{},icon:{xlinkHref:s},fade:n,hash:"GpQYrJ",href:"http://codepen.io/anthonykoch/pen/GpQYrJ",meta:{likes:37},id:"cjng7t3tr0004amyqlwadeoie"},{title:"Social Connect",image:{url:"/_nuxt/img/c9aeb13.png"},thumbnail:{},icon:{xlinkHref:s},fade:n,hash:"MaQBrd",href:"http://codepen.io/anthonykoch/pen/MaQBrd",meta:{likes:46},id:"cjng7t3tr0005amyqhozw2bx5"}]},posts:{postsById:{},meta:[{excerpt:{content:"<p>It's become a common pattern in the JavaScript world to use the <code>||</code> (called the &quot;logical or&quot;) operator for the purpose of setting a default value for a function argument. While it works quite well in most cases, but there are two cases where troubles may arise.</p>\n",loc:{start:0,end:291}},author:e,title:"OR operator gotcha",tags:["javascript","anti-patterns","operators"],id:9,skip:{section:"#the-gotcha"},created_at:"2018-08-29T00:00:00.000Z",humanized:{created_at:"August, 28 2018"},url:"/blog/or-operator-gotcha",slug:"or-operator-gotcha"},{excerpt:{content:"<p>To use <code>normalize.css</code> or to not use <code>normalize.css</code>. That is the question. I'll say that if you're supporting older browsers (especially IE), you should definitely be using it. However, before we get into why you should use it, let's go over what CSS resets are and how they differ from <code>normalize.css</code>.</p>\n",loc:{start:0,end:345}},author:e,title:"Use normalize css",tags:["css","normalize"],id:8,created_at:"2018-08-03T00:00:00.000Z",humanized:{created_at:"August, 2 2018"},url:"/blog/use-normalize-css",slug:"use-normalize-css"},{excerpt:{content:'<p>I rewrote my website and blog using <a href="https://nuxtjs.org/">nuxt.js</a>. The experience did not come without a bit of blood, sweat, and tears, but I\'m happy with the end result. This is not so much a tutorial as it is a reflection on the experience and why I did what I did.</p>\n',loc:{start:0,end:288}},author:e,title:"Just Nuxt Things",tags:["nuxt","vue","webpack"],id:7,created_at:"2018-07-29T00:00:00.000Z",humanized:{created_at:"July, 28 2018"},url:"/blog/just-nuxt-things",slug:"just-nuxt-things"},{excerpt:{content:"<p>Several months ago, I set out to get a deeper understanding of JavaScript, specifically in the area of prototypes. Prototypes were a fuzzy concept for me. I sort of knew how to use them, but didn't fully understand them. After a lot of study, I've started to see the picture of how prototypes work, and that they are not as complicated as I first thought.</p>\n",loc:{start:0,end:363}},author:e,title:m,tags:[t,f],id:6,created_at:b,humanized:{created_at:"January, 20 2016"},url:o,slug:"understanding-javascript-prototypes"},{excerpt:{content:g,loc:{start:0,end:322}},author:e,title:I,tags:[k,l,i],id:5,created_at:r,humanized:{created_at:c},url:p,slug:d},{excerpt:{content:"<p>I had a friend ask me why you shouldn't iterate over arrays with a for-in loop, since after all, when he tried it everything worked as expected. Well, the reasoning for why you shouldn't do this is not immediately apparent, especially if you do not understand how property lookup and prototypes work.</p>\n",loc:{start:0,end:308}},author:e,title:j,tags:[t,v],id:4,created_at:A,humanized:{created_at:"December, 2 2015"},url:y,slug:"why-you-shouldnt-loop-arrays-with-for-in"},{excerpt:{content:"<p>After an hour of research, trial, and error, I finally figured out how to get Con Emu to remember directories for tabs using Git Bash. When I first started using Con Emu, I swear it used to do this by default, but I guess updates in Con Emu or the Git Bash shell broke this feature. Either way, I've found a solution that worked for me to get this feature back.</p>\n",loc:{start:0,end:369}},author:e,title:"Remember directories in Con Emu",tags:["con emu","command line"],id:3,created_at:"2015-11-15T00:00:00.000Z",humanized:{created_at:"November, 14 2015"},url:"/blog/remember-directories-in-con-emu",slug:"remember-directories-in-con-emu"},{excerpt:{content:"<p>This is an overview of some of the development tools I've found useful, as well as some opinions and experiences I have had with them.</p>\n",loc:{start:0,end:142}},author:e,title:"The tools I use",tags:["development","tools"],id:2,created_at:"2015-08-21T00:00:00.000Z",humanized:{created_at:"August, 20 2015"},url:"/blog/the-tools-i-use",slug:"the-tools-i-use"},{excerpt:{content:"<p>ES2015, formerly called ES6, brings a lot of great features to JavaScript. A lot of the new features provide a much cleaner syntax for common tasks, and makes writing JavaScript so much better. After using these features for a while, I can't imagine going back to ES5. Here's an overview of my favorite features of ES2015.</p>\n",loc:{start:0,end:330}},author:e,title:"My favorite features of ES2015",tags:[t,"ES2015"],id:1,created_at:"2015-08-17T00:00:00.000Z",humanized:{created_at:"August, 16 2015"},url:"/blog/favorite-features-of-ES2015",slug:"favorite-features-of-ES2015"}]},navigation:{links:[{text:"work",href:T,active:T,scrollTo:"#work"},{text:"blog",href:"/blog",active:"/blog/"},{text:"contact",href:"/contact",active:"/contact/"}]},fullscreenImage:{isFullscreenImageShowing:!1,fullscreenImageSrc:"data:image/gif;base64,R0lGODlhAQABAIAAAP///wAAACH5BAEAAAAALAAAAAABAAEAAAICRAEAOw==",fullscreenImageAlt:""}},serverRendered:!0}}("Anthony Koch",0,"JavaScript","icon-codepen-outline","codepen","/blog/understanding-javascript-prototypes","medium","lazy loading",0,"2016-01-07T00:00:00.000Z","January, 6 2016","/blog/medium-style-images","medium-style-images",0,"Understanding JavaScript Prototypes",'<p>I was on the <a href="https://medium.com/">Medium</a> website and noticed a cool effect  they do when they lazy load their images. The image first appears blurry, and then slowly unblurs or fades out to reveal the actual image. I thought this was pretty cool, and wanted to see if I could achieve a similar effect.</p>\n',"prototypes",0,"2016-01-21T00:00:00.000Z","/blog/why-you-shouldnt-loop-arrays-with-for-in","Why you shouldn't loop arrays with for-in","arrays",0,"2015-12-03T00:00:00.000Z","Medium style image loading","stackblur","/#work")</script><script src="/_nuxt/fb0edb8507785c3f920b.js" defer></script><script src="/_nuxt/e77860e6bbac41e8990e.js" defer></script><script src="/_nuxt/939af23866584e38578e.js" defer></script><script src="/_nuxt/618ef3dd2a507e0bd94f.js" defer></script><script src="/_nuxt/33e2ccdd4d1bd71f9ba2.js" defer></script>
  </body>
</html>
